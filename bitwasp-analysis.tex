% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is the TeX file for BitWasp Architecture Analysis for the project AmpedMarket
% https://github.com/ampedup/AmpedMarket

% For more information contact amphetamine@tormail.org

% This TeX file will build with just texlive-base and texlive-latex-base. Keep it that way!

\documentclass[11pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)


%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....

\usepackage{graphicx} % support the \includegraphics command and options

%%% PACKAGES
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim


%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}


%%% END Article customizations

%%% The "real" document content comes below...

\title{BitWasp Architecture Analysis}
\author{ampedup [amphetamine@tormail.org]}
\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle

\newpage

\tableofcontents

\newpage

\section{Introduction}

This document aims to provide a clear, well specified summary of the BItWasp project and very clear indiciations of its progress so far based solely on the existing source for BitWasp.

\subsection{Rationale}

Properly specifying BitWasp and evaluating its progress is a key step before performing any modifications to the software. This information will be invaluable to further project decision making and will also greatly benefit the original BitWasp project.

\subsection{Methodology}

The structure analysis of the software has been done using Visual Paradigm to extract class data organized by directory. Dependencies and coding conventions are discovered through both the UML class design and manual code auditing. 

\newpage

\section{Coding Conventions}
\subsection{Naming Conventions}
\subsubsection{Classes}
\subsubsection{Methods}
\subsubsection{Attributes}
\subsubsection{Instance Variables}
\subsection{Syntax Conventions}
\subsubsection{PHP Tags}
\subsubsection{Classes}
\subsection{Layout Conventions}
\newpage

\section{Dependencies}
\subsection{Frameworks}
\subsubsection{CodeIgniter}
\subsection{PHP Libraries}
\subsubsection{php-gd}
\subsection{External Software}
\subsubsection{GPG}
\subsubsection{bitcoind}
\newpage

\section{Path Structure}
\subsection{Application (application/)}
\subsubsection*{config}
\textbf{} \\
\subsubsection*{controllers}
\subsubsection*{errors}
\subsubsection*{language}
\subsubsection*{libraries}
\subsubsection*{models}
\subsubsection*{views}
\subsection{System (system/)}
\subsubsection*{core}
\subsubsection*{database}
\subsubsection*{helpers}
\subsubsection*{language}
\subsubsection*{libraries}
\subsection{Root directory (/)}
\newpage

\section{Class Structure}
\subsection{Controllers}
\subsubsection{Account}
\begin{description}
\item[Description:] The class handles the Account management interface. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Account object. Calls the parent constuctor and loads required libraries and models.
\item[index()]  \textbf{ }\\
Loads data for the account/index page ("My Account") and loads the layout library.
\item[edit()]  \textbf{ }\\
Loads data for the account/edit page ("Edit Account") and loads the layout library.
\item[replacePGP()]  \textbf{ }\\
Loads data for the account/replacePGP page ("Replace PGP key"), handles the updating of PGP keys and loads the layout library.
\item[update()]  \textbf{ } \\
Handles updating of the account information.
\item[deletePubKey()]  \textbf{ }\\
Delete the stored pubKey for the user, and disable two-step authentication if necessary.
\end{description} 
\end{description} 


\subsubsection{Admin}
\begin{description}
\item[Description:] The class handles the Admin management interface. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Account object. Calls the parent constuctor and loads required the model.
\item[index()]  \textbf{ }\\
Loads data for the admin/siteConfig page ("Admin Panel") and loads the layout library.
\item[users(\$userHash = NULL)]  \textbf{ }\\
Loads data for the admin/users page ("Users") and loads the layout library.
\item[editConfig()]  \textbf{ }\\
Loads data for the admin/editConfig page ("Edit Configuration") and loads the layout library.
\item[updateConfig()]  \textbf{ }\\
Handles updating of the site configuration.
\item[fixOrphans()]  \textbf{ }\\
Handles the removal of orphan categories.
\item[removeCategory()]  \textbf{ }\\
Loads data for the admin/removeCategory page ("Remove Category"), handles category removal and loads the layout library.
\item[addCategory()]  \textbf{ }\\
Loads data for the admin/addCategory page ("Add Category"), handles category addition and loads the layout library.
\item[check\_parentID\_exists(\$parentID)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks that the category identified by \$parentID has a parent that exists.
\item[check\_category\_exists(\$id)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks that the category identified by \$id exists.
\end{description} 
\end{description} 


\subsubsection{Bitcoin}
\begin{description}
\item[Description:] The class handles the Bitcoin management interface. It is in its very early stages. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Account object. Calls the parent constuctor and loads required the model.
\item[index()]  \textbf{ }\\
Loads some test data using a JSON interface to a hardcoded bitcoin server using hardcoded credentials and loads the layout library.
\end{description} 
\end{description} 


\subsubsection{Error}
\begin{description}
\item[Description:] The class handles displaying of errors. Extends CI\_Controller.
\item[Attributes:] \textbf{ }
\begin{description}
\item[\$params]  \textbf{ }\\
Array instance variable not actually used in the code.
\end{description}
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Empty constructor.
\item[index(\$params)]  \textbf{ }\\
Loads data pertaining to the error and displays the error.
\end{description} 
\end{description} 


\subsubsection{Home}
\begin{description}
\item[Description:] The class handles display of the home page. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Home object. Calls the parent constuctor.
\item[index()]  \textbf{ }\\
Loads data for the home/index page ("Home") and loads the layout library.
\end{description} 
\end{description} 


\subsubsection{Items}
\begin{description}
\item[Description:] The class handles the display of items in the marketplace. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Items object. Calls the parent constuctor and loads required the models and libraries.
\item[tmp\_items\_per\_page()]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Handles the changing of items shown per page for the session.
\item[index()]  \textbf{ }\\
Loads data for the items/index page ("Items"), "paginates" the lastest items and loads the layout library.
\item[view(\$itemHash)]  \textbf{ }\\
Loads data specified item and displays it if it exists, otherwise it  "paginates" the lastest items loads the layout library. Display of user feedback is commented out.
\item[cat(\$catID = FALSE)]  \textbf{ }\\
Loads items for specified category if it exists and "paginates" the items, otherwise it "paginates" the latest items and loads the layout library.
\item[check\_category\_exists(\$id)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks whether or not the specified category exists.
\end{description} 
\end{description} 


\subsubsection{Listings}
\begin{description}
\item[Description:] The class handles the management of listings in the marketplace. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Listings object. Calls the parent constuctor and loads required the models and libraries.
\item[edit(\$itemHash)]  \textbf{ }\\
Loads data for the listings/editConfig page ("Edit Configuration") and loads the layout library.
\item[manage()]  \textbf{ }\\
Loads data for the listings/manage page ("Manage Listings") and loads the layout library.
\item[images(\$itemHash)]  \textbf{ }\\
Loads data for the listings/images page ("Item Images") and loads the layout library.
\item[mainImage(\$imageHash)]  \textbf{ }\\
Handles the selection of the main image for listings, loads the data for the result and loads the layout library.
\item[imageRemove(\$imageHash)]  \textbf{ }\\
Handles the removal of images for listings, loads the data for the result and loads the layout library.
\item[imageUpload(\$itemHash)]  \textbf{ }\\
Handles the upload of images for listings, loads the data for the result and loads the layout library.
\item[remove(\$itemHash)]  \textbf{ }\\
Handles the removal of items from vendor listings, loads the data for the result and loads the layout library.
\item[create()]  \textbf{ }\\
Loads data for the listings/addItem page ("Add Item") and loads the layout library.
\end{description} 
\end{description} 

\subsubsection{Messages}
\begin{description}
\item[Description:] The class handles the management of user messages. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Messages object. Calls the parent constuctor and loads required the models and libraries.
\item[inbox()]  \textbf{ }\\
Loads data for the messages/inbox page ("Inbox") and loads the layout library.
\item[delete(\$messageHash)]  \textbf{ }\\
Handles the deletion of messages, loads the data for the result and loads the layout library.
\item[read(\$messageHash)]  \textbf{ }\\
Loads data for the specified message for the messages/read page and loads the layout library.
\item[remove(\$itemHash)]  \textbf{ }\\
Handles the removal of items from vendor listings, loads the data for the result and loads the layout library.
\item[send(\$toHash = NULL)]  \textbf{ }\\
Loads data for the messages/send page ("Send Message"), handles message sending and loads the layout library.
\end{description} 
\end{description} 

\subsubsection{Orders}
\begin{description}
\item[Description:] The class handles the management of orders. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Orders object. Calls the parent constuctor and loads required the models and libraries.
\item[index()]  \textbf{ }\\
Loads data for the orders/index page ("Orders") and loads the layout library.
\item[recount()]  \textbf{ }\\
Handles the update of order quantities, loads the data for the result and loads the layout library.
\item[orderItem(\$itemHash)]  \textbf{ }\\
Handles the creation of a new order for the specified item, loads the data for the result and loads the layout library.
\item[place(\$sellerHash)]  \textbf{ }\\
Handles the placement of orders with vendors, loads the data for the result and loads the layout library.
\item[review(\$id)]  \textbf{ }\\
Handles the placement of feedback on orders, loads the data for the result and loads the layout library.
\item[confirmDispatch(\$buyerHash)]  \textbf{ }\\
Handles the update of dispatch status on orders, loads the data for the result and loads the layout library.
\item[confirmPayment(\$buyerHash)]  \textbf{ }\\
Handles the payment confirmation on orders, loads the data for the result and loads the layout library.
\item[purchases()]  \textbf{ }\\
Loads data for the orders/purchases page ("Purchases") and loads the layout library.
\item[callback\_check\_rating(\$param)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks whether the feedback value provided is within the specified range (1-5 inclusive).
\end{description} 
\end{description} 

\subsubsection{Pages}
\begin{description}
\item[Description:] The class handles display of the custom pages. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Pages object. Calls the parent constuctor.
\item[view(\$page = 'home')]  \textbf{ }\\
Loads data for the specified page and loads the layout library.
\end{description} 
\end{description} 

\subsubsection{Users}
\begin{description}
\item[Description:] The class handles the user management interface. Extends CI\_Controller.
\item[Attributes:] None.
\item[Methods:] \textbf{ }
\begin{description}
\item[\_\_construct()]  \textbf{ }\\
Constructor for the Users object. Calls the parent constuctor and loads required the models and libraries.
\item[registerPGP()]  \textbf{ }\\
Loads data for the users/registerPGP page ("Setup PGP"), handles PGP key registration and loads the layout library.
\item[twoStep()]  \textbf{ }\\
Loads data for the users/twoStep page ("Two Step Authentication"), handles verification of the two step authentication and loads the layout library.
\item[logoutInactivity()]  \textbf{ }\\
Loads data for the users/login page ("Login"), notifies the user that the previous session has timed out, and loads the layout library.
\item[view(\$userHash)]  \textbf{ }\\
Loads data for the users/individual page for the specified user and loads the layout library.
\item[login()]  \textbf{ }\\
Loads data for the users/login page ("Login"), handles user credential and CAPTCHA authentication and loads the layout library.
\item[logout()]  \textbf{ }\\
Logs out the user and redirects them to the users/login page.
\item[register()]  \textbf{ }\\
Loads data for the users/register page ("Register"), handles user registration and CAPTCHA authentication and loads the layout library.
\item[find\_role(\$roleId)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Resolves the role ID to a string "Vendor" or "Buyer".
\item[check\_captcha(\$string)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks the validity of the CAPTCHA answer.
\item[register\_check\_role(\$role)]  \textbf{ }\\
\textbf{Method does not follow naming conventions!} Checks whether the role value provided is within the specified range (1-2 inclusive).
\end{description} 
\end{description} 

\subsection{Libraries}
\subsubsection{General}
\subsubsection{jsonRPCClient}
\subsubsection{Layout}
\subsubsection{My\_captcha}
\subsubsection{My\_config}
\subsubsection{My\_image}
\subsubsection{My\_session}


\subsection{Models}
\subsubsection{Accounts\_model}
\subsubsection{Admin}
\subsubsection{Bitcoin}
\subsubsection{Error}
\subsubsection{Home}
\subsubsection{Items}
\subsubsection{Account}
\subsubsection{Admin}
\subsubsection{Bitcoin}
\subsubsection{Error}
\subsubsection{Home}
\subsubsection{Items}

\end{document}
